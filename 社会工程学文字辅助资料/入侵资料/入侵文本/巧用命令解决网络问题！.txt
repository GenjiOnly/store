D0000D发往论坛板块-------------------------------------------------------
No2  号板块  技术文章
D8888D贴子标题-------------------------------------------------------
巧用命令解决网络问题！
D8888D主贴内容-------------------------------------------------------
转载来源于开创网安 [url=http://bbs.16kc.net]链接标记http://bbs.16kc.net[/url] JHACKJ 2008最新打造
　为了防止非法用户通过本地工作站系统默认开启的隐藏共享，来攻击本地系统或偷窥本地重要隐私信息，我们常常会打开本地系统的服务列表窗口，进入Server服务的属性设置界面，采用手工方法将Server服务停止运行，从而实现关闭本地系统隐藏共享的目的。
　　可是有些时候，我们无论怎么操作，都无法进入进入Server服务的属性设置界面，这么一来我们就无法通过停用Server服务的方法来关闭系统隐藏共享了，如此说来在服务窗口无法打开的情况下，我们就无法将本地工作站中的隐藏共享关闭掉了吗?
　　答案是否定的!我们可以借助Windows工作站内置的Sc命令，来巧妙地将工作站系统中的Server服务停止运行，从而实现一次性关闭系统所有隐藏共享的目的，下面就是该方法的具体实施步骤：
　　首先以系统管理员身份登录进本地工作站系统，依次单击该系统桌面中的“开始”、“运行”菜单选项，打开本地工作站的系统运行框，在其中输入字符串命令“cmd”，单击回车键后，进入到MS-DOS工作窗口。
　　在MS-DOS窗口的命令行提示符下，执行“sc config lanmanserver start= disabled”字符串命令，当系统弹出如下图所示的成功提示时。那么我们不用进入Server服务的属性设置界面，就能轻松地将系统服务Server停止运行了，此时我们再查看系统的隐藏共享资源时，就会看到所有的隐藏共享资源全部被一次性删除掉了，这样的话非法用户就无法通过隐藏共享对本地工作站实施攻击安全了 。
　　巧用Regsvr32，解决IP地址频繁冲突故障

　　在局域网环境中，为了有效提高工作站的网络登录速度，同时方便网络管理员高效管理网络，局域网中的所有工作站常常被设置成使用静态IP地址。
　　可是，在Windows窗口下普通用户只要遇到不能上网的网络故障，就会随意进入到对应工作站中的TCP/IP属性设置窗口，来胡乱更改IP地址，这么一来整个局域网中就会频繁发生IP地址互相冲突的故障现象，如此一来反而给局域网的管理维护带来负面影响。
　　为了解决局域网工作站IP地址频繁发生冲突故障，我们可以巧妙地利用系统自带的Regsvr32命令，来将“网络连接”图标隐藏起来，这样普通用户找不到“网络连接”图标，就无法随意对工作站的IP地址进行修改了，下面就是该方法的具体实施步骤：
　　由于用户只有进入“网络连接”的属性设置界面，才能对工作站的IP地址进行修改操作，而“网络连接”属性设置界面的显示与系统的动态链接文件Netshell.dll、Netman.dll、Netcfgx.dll有关，这些链接文件全部都是工作站系统的控件，它们在默认状态下会被Windows操作系统自动注册。
　　现在，我们可以利用Regsvr32命令将上面几个动态链接文件从系统中反注册掉，日后普通用户想进入“网络连接”属性设置界面来修改工作站IP地址时，系统由于无法找到对应的动态链接文件，就会不显示“网络连接”属性设置界面，那样的话普通用户自然也就无法随意修改IP地址了。
　　在对动态链接文件Netshell.dll、Netman.dll、Netcfgx.dll进行反注册操作时，我们可以先以系统管理员身份登录进本地工作站系统，依次单击该系统桌面中的“开始”、“运行”菜单选项，打开本地工作站的系统运行框，在其中输入字符串命令“cmd”，单击回车键后，进入到MS-DOS工作窗口。
　　在MS-DOS窗口的命令行提示符下，执行“Regsvr32 /u Netshell.dll”输入字符串命令，当系统弹出如下图所示的提示信息时，那就说明本地工作站的Netshell.dll动态链接文件就从系统中成功反注册掉了。按照相同的操作办法，我们再在命令行提示符下依次执行字符串命令“Regsvr32 /u Netcfgx.dll”、“Regsvr32 /u Netman.dll”，来将本地工作站中的动态链接文件Netcfgx.dll、Netman.dll反注册掉。当结束所有动态链接文件的反注册操作后，我们再尝试修改工作站的IP地址时，就会发现该系统中的TCP/IP属性设置窗口无法进入了，这样我们就顺利解决IP地址频繁冲突故障了。


巧用netsh，解决系统隐性网络故障

　　单位局域网中有一台Vista工作站，遇到了无法上网的故障，具体现象为本地连接图标显示正常，有发送数据包和接收包，不过该工作站无法访问内网和外网。笔者先检查了该工作站的网卡设备，发现该设备黄色信号灯亮但没有闪烁，黄色信号灯亮就表明该网卡设备已经与网络建立了连接，信号灯不闪烁就意味着工作站没有发生数据交换行为。会不会是网络线缆发生了短接或断路现象呢?
　　笔者迅速从朋友那里借来了专业线缆测线器，来对网络连接线缆的连通性进行测试，经过测试笔者发现8个信号灯依次亮，这也证明网线线缆没有任何问题。到了这里，笔者基本可以断定该故障不是网络与硬件问题，而应该是工作站系统自身设置问题了。导致工作站无法上网的因素有很多，不过总体来说系统自身设置可以从下面几个角度考虑：
　　首先进入Vista工作站的TCP/IP属性设置界面，检查本地工作站的上网参数是否有错误，包括IP地址、网关地址、子网掩码、DNS服务器地址等，结果笔者发现这些参数设置都正确。
　　再进入IE选项设置界面，检查其中是否启用了代理上网功能，结果也没有，然后进入到IE浏览器的高级选项设置界面，将其中的所有设置全部恢复到默认状态，经过实际测试还是无法上网。经仔细询问该工作站之前没有发生过“IP地址冲突”故障，也没有启用防火墙软件 有没有可能是网卡设备的物理地址发生丢失或是工作站系统没有扫描到网卡设备呢?
　　于是笔者按照前面操作步骤，进入到MS-DOS工作窗口，并在该窗口的命令行中执行字符串命令“ipconfig /all”，结果笔者看到网卡设备的IP地址以及物理地址都存在且正确。
　　下面笔者又尝试对本地连接进行修复，将本地连接图标先暂时禁用掉，过一段时间后又重新开启本地连接，再进行测试时发现工作站还是无法上网。不得已笔者只好重新启动了一下Vista工作站，可是这样的努力依然没有任何效果。
　　在万般无奈之下，笔者到网上搜索相关故障现象，偶然之间看到Vista系统有时会遇到Winsock设置错误问题，这种隐性错误可能就是Vista工作站无法上网的原因所在。于是笔者小心翼翼地按照如下步骤，来尝试将Vista系统的Winsock设置状态恢复到正确状态：
　　首先以系统管理员身份登录进本地工作站系统，依次单击该系统桌面中的“开始”、“运行”菜单选项，打开本地工作站的系统运行对话框，在其中输入字符串命令“cmd”，单击回车键后，进入到MS-DOS工作窗口。
　　在该工作窗口的命令提示符，输入“netsh winsock reset”字符串命令，单击回车键后，Vista系统开始对Winsock设置进行自动恢复操作，等到恢复操作完毕后，笔者又将Vista工作站系统重新启动了一下，再进行测试上网时，发现无法上网的网络故障现象已经消失了。这说明上面的网络故障是由Vista系统中的隐性错误引起的，日后遇到类似故障现象时，我们可以尝试使用netsh命令将Vista系统的隐性错误排除掉。

　　巧用RunAs，解决无权维护服务器故障

　　为了保证局域网服务器能够安全运行，相信许多操作者平时都不会使用特权帐号登录系统并维护服务器，然而在实际维护服务器的时候，不少应用程序必须在系统管理员权限状态下才能运行。
　　遇到这种现象时，很多朋友往往会无奈地使用特权帐号重新登录服务器系统，来运行这些特殊的应用程序，然而在特权运行状态下，服务器的运行安全性也受到了很大的威胁。为了既能保障服务器的安全，又能正常运行一些特殊的应用程序，我们可以巧妙地借助服务器系统自带的RunAs命令，来让服务器在普通帐户权限状态下也能允许我们对服务器执行维护、管理操作，下面就是该方法的具体实现步骤：
　　首先以普通用户身份登录进行服务器系统，使服务器运行于普通帐号权限状态下，在该状态下，用鼠标逐一单击系统桌面中的“开始”/“运行”命令，在弹出的系统运行框中输入“cmd”字符串命令，单击回车键后，将服务器系统界面切换到MS-DOS窗口。
　　其次在该窗口的命令提示符下输入字符串命令“runas /user:cmd”，其中“domain”指的是服务器所在域，要是局域网环境中没有域时，那“domain”就是本地服务器的主机名称，“account”为系统特权帐号名称;当我们单击回车键后，系统会要求我们输入特权帐号的登录密码。
　　一旦密码输入正确后，我们再单击一下回车键，在其后弹出的命令窗口中，我们就能通过相关网络命令对服务器进行特权维护操作了;等到特权维护操作结束后，我们还要记得及时将特权命令窗口关闭掉，如此一来服务器的安全就能得到很好保证了。
