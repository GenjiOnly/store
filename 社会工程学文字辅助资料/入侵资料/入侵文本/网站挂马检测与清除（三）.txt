D0000D发往论坛板块-------------------------------------------------------
No2  号板块  技术文章
D8888D贴子标题-------------------------------------------------------
网站挂马检测与清除（三）
D8888D主贴内容-------------------------------------------------------
二、清除网站中的恶意代码（挂马代码）
1.确定挂马文件
清除网站恶意代码首先需要知道哪些文件被挂马了，判断方法有三个，方法一就是通过直接查看代码，从中找出挂马代码；方法二是通过查看网站目录修改时间，通过时间进行判断；方法三使用本文提到的软件进行直接定位，通过监听找出恶意代码。在本案例中，网站首页是被确认挂马了，通过查看时间知道被挂马时间是8月25日左右，因此可以通过使用资源管理器中的搜索功能，初步定位时间为8月24日至26日，搜索这个时间范围修改或者产生的文件，如图5，图6所示，搜索出来几十个这个时间段的文件。

[img]http://blog.51cto.com/attachment/200809/200809251222318197390.jpg[/img]


图5 搜索被修改文件


[img]http://blog.51cto.com/attachment/200809/200809251222318216031.jpg[/img]


图6 搜索结果

2.清除恶意代码
可以使用记事本打开代码文件从中清除恶意代码，在清除代码时一定要注意不要使用FrontPage的预览或者设计，否则会直接访问挂马网站，感染木马程序。建议使用记事本等文本编辑器。在清除恶意代码过程中，发现挂马者竟然对js文件也不放过，如图7所示。

[img]http://blog.51cto.com/attachment/200809/200809251222318239859.jpg[/img]


图7 对js文件进行挂马

技巧：
可以使用Frontpage中的替换功能替换当前站点中的所有指定代码。
总结
本文操作简单，写起来比较复杂，关键在于使用urlsnooper软件定位挂马网页文件，然后就是对挂马代码（恶意代码）进行分析，最后是手工活，清除网站中的恶意代码。

D8888D回贴内容-------------------------------------------------------
学习了！！！

D8888D回贴内容-------------------------------------------------------
图挂了
