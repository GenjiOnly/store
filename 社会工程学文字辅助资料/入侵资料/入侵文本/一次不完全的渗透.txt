D0000D发往论坛板块-------------------------------------------------------
No2  号板块  技术文章
D8888D贴子标题-------------------------------------------------------
一次不完全的渗透
D8888D主贴内容-------------------------------------------------------
 

    看了那么多大牛都发出渗透笔记和渗透心的，我也有点手痒了，想做出一点点贡献，虽然技术有限，而且最终也没有拿到SHELL，不过却从这次渗透过程中学到了一些东西。
    我平时无聊的时候都喜欢玩FLASH游戏，所以针对自己喜欢的FLASH GAME站都会检查一下安全性，之前一直都会上一个域名为www.m**f.net的FLASH网站所以顺便做一下检测，网站分两部分，主站是一个不知名程序做的，感觉像是站长自己写的，界面非常漂亮，BBS用的是Discuz!NT 2.0版本。DZ.NET的漏洞很少，随便看了一会就打算从主页踩点，因为这次是对网站做检查所以就没有扫端口，只用了C类旁注大器扫了一下可能存在的目录和冗余文件（C类大器很实用，现在碰到搞不定的站都喜欢先扫一下。），不过没有获得可用的信息，主站的后台地址也未找到，而且用户登录信息是调取BBS的，所以估计主站所用的数据库连接账户有BBS数据库的读权限，或者就是放在同一个数据库里的。在经过一番查找后在网站搜索的地方发现了一个注入点，不过在利用的时候发现程序调用了JOIN的语句并且输入的内容会被用于多处地方，在测试N次后发现除了select，还是select，更奇怪的是如果用select top 1 name from sysobjects/master..sysdatabases where xtype='U' and name not in('') 语句只能读出第一和第二个表或者数据库名，第三个信息始终无法获取，换了一种还是无果，不过可以确定的是主站的数据库和BBS的数据库是分离的。不过毕竟有SELECT，所以就加上了like条件，按字母吧BBS的数据库名和主站的一些关键表明猜了出来，最终BBS数据库是："M**F_BBS"，然后直接跨库搜出了后台管理员的用户名及密码，在CMD5上破了一下无果，用CMD5提供的收费破解同样无果(还好每次破解只需几块钱，损失不是很大，呵呵)，好像一下子卡住了（我不知道Discuz!NT 2.0 版本能不能cookies欺骗，因为很不爽也就没有去研究过，直觉告诉我不太可能！如果有办法请大牛指点一下！）。
    喝了杯咖啡，考虑了一会，还是决定去下一个这个版本的DZ看看，在自己的虚拟机里设置完后发现里面的密码找回功能可以找回管理员的密码，验证的方法也很简单，系统随机生成一个类似HASH的数值，加上需要找回的用户名，然后就可以直接修改密码了，在自己的虚拟机里测试了一下，成功！而且发现一个问题，不管针对同一个账户提交了几次密码找回，在数据库中保存的始终是最后一次密码找回的验证信息，所以提交了密码找回后直接SELECT管理员账户的验证信息就可以了。现在我有了BBS的select权限（只有这个权限，否则直接改密码多爽！），所以直接找了管理员用户名直接使用“密码找回”功能，不过又有了问题，密码找回功能无法使用，点了提交后没反应，没办法，在自己虚拟机里提交了一次，抓包，修改+NC提交！然后在数据库的dnt_userfields表中找到了验证码，最后成功修改了管理员密码，当然这些都是躲在代理后面做的。然后登陆BBS后台，但是最郁闷的事情发生了，后台地址被修改了，扫了一下，猜了几次都无果，然后用这个账户登录主页，提示我是管理员但是没有指出后台目录，然后随便翻了一会！！！最终也只能放弃！由于只是想检测一下，所以什么扫描、C段也没必要去弄！
    这个算是一次不成功的渗透，虽然没拿到WEBSHELL，不过也开阔了一下思路，如果有办法可以拿SHELL，请大牛指点，感激ing
