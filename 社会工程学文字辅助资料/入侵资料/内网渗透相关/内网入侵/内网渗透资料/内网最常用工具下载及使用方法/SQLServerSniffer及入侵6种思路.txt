  一般来说，拥有了目标系统管理员的“用户名/密码”，就可以通过远程连接“接管”目标系统。因此，如何获取目标系统管理员的“用户名/密码”常常是黑客们最关心的任务。在本章中，我们就以“基于认证的入侵”为例，来介绍黑客的入侵手段。
       对于黑客如何获取目标系统管理员的密码的方法，我们发现主要以下几种：
       1、弱口令扫描：该方法最简单，黑客通过扫描目标网络中的大量主机，从中找出一两个存在弱口令的主机；
       2、暴力破解：密码的终结者，获取密码只是时间问题。比如，通过字典文件实施本地暴力破解，远程暴力破解；
       3、密码监听：通过Sniffer（嗅探器）来监听网络中的数据包，从而获取密码；如果我们的网络是明文传输的，那么黑客就很容易监听到我们网络中的密码。
       4、社会（交）工程学：通过欺骗手段或人际关系获取密码。
        5、其他方法：例如在入侵成功后安装木马或者键盘记录程序等。

       实例一：通过Sniffer获取SQL_Server帐号和密码

       工具：SQLServerSniffer
       该工具在命令行下使用，能够在局域网环境中获取SQL Server密码，而且可以自定义SQL Server的监听端口。使用命令为“SQLServerSniffer <SQLServerPort>“，参数<SQLServerPort>为SQL服务器的端口，一般为1433端口。
       当SQLServerSniffer启动后，该窗口属于嗅探状态，一旦嗅探到本局域网内SQL服务器登录操作后，立刻把登录的帐号和密码显示出来，并马上又进入嗅探状态。
        无论sa密码多复杂，SQLServerSniffer都能马上探测出来。执行SQLServerSniffer后，该窗口会一直保持监听状态，直到使用“Ctrl+C“结束监听。

       实例二、通过Sniffer获取POP3、FTP帐户密码

       工具：FsSniffer
       该工具可以捕抓到本机和基于非交换环境局域网的POP3/FTP的用户名和密码。
       假设黑客已经获取主机211.0.0.1的一个管理员组的帐号，首先将FsSniffer复制到211.0.0.1。然后，利用流光IV中的NTCMD启动FsSniffer.exe，并将齐安装成为服务。这样，黑客就在远程主机上面安装一个服务ShadowSniffer。接下来用net命令启动服务。过一段时间就可以登录到FsSniffer的端口7上查看结果了。

        实例三、 暴力破解

       工具：WMICracker
       一款破解NT主机帐号密码的工具，是Windows NT/2000/XP/2003的杀手，破解的时候需要目标主机开放135端口，这是大多数主机满足的。
        使用方法：WMICracker.exe <IP> <Username> <Password File> [Threads]
        <IP>： 目标IP
       <Username>：待破解密码的帐号，必须属于管理员组。
        <Password File>：密码字典文件。
       [Thread]：线程数，默认为80，该数值越大，破解速度越快。

        实例四、 Telnet入侵

         对于Telnet的认识，不同人持有不同的观点。作为网管，我们认为Telnet是一种网管工具，我们通过Telnet对各种网络设备进行调试。
       但是对于黑客而言，Telnet则成为一种黑客手段。一旦黑客与远程主机建立了Telnet链接，黑客便可以使用远程主机上的软硬资源，为黑客执行暴力破解，代理扫描，跳板入侵，发动拒绝服务攻击等任务。
       因此，我们应该尽量避免网络中的设备提供Telnet服务，如果必须提供，那么就要加强Telnet的身份/密码验证。其中微软提供的NTLM验证，就是那一种行之有效的Telnet身份验证方式。
       1、关于NTLM验证
        Telnet服务所提供的功能过于强大，也是黑客使用最频繁的远程登录，夺取控制权的手段之一。因此，微软公司为Telnet添加了身份验证，称为NTLM验证，它要求Telnet终端除了需要有Telnet服务器主机的用户名和密码外，还需要满足NTLM验证关系，NTLM验证大大增强了Telnet主机的安全性，就像一只拦路虎把许多黑客拒之门外。
        2、反NTLM验证入侵
        然而，不幸的是，NTLM验证并不是牢不可破的，他并没有让我们彻底放心。只要黑客通过一种称之为烦NTLM验证入侵的方式，仍然可以轻而易举地绕过NTLM验证，闯过我们的系统。
       下面，我们将通过一个例子，来介绍黑客绕过NTLLM验证，夺取目标系统的控制权，然后为目标系统安装不容易被发现的后门Telnet服务，从而让黑客实现永远占用目标系统的目的。另外，为了简化实例，我们假设目标网络中存在NT弱口令的主机。
        工具：
        X-Scan：用来扫描出目标网络中存在的NT弱口令的主机。
        opentelnet：用来除NTLM验证、开启Telnet服务。修改Telnet服务端口。
        AproMan：用来查看进程、杀死进程。
        instsrv：用来给主机安装服务。
        （1）AproMan简介
        AproMan以命令行方式查看进程、杀死进程，不会被杀毒软件查杀。举个例子，如黑客发现目标主机上运行有杀毒软件，将导致上传的工具被杀毒软件查杀，那么他们就会要在上传工具前关闭杀毒防火墙。使用方法如下：
       c:\AproMan.exe -a                        显示所有进程
       c:\AproMan.exe -p                        显示端口进程关联关系（需Administrator权限）
       c:\AproMan.exe -t[PID]                 杀掉指定进程号的进程
       c:\AproMan.exe -f[FileName]        把进程及模块信息存如文件
         （2）instsrv简介
         instsrv是一款用命令行就可以安装、卸载服务的程序，可以自由指定服务名称和服务所执行的程序。instsrv的用法如下：
           安装服务： instsrv <服务名称> <执行程序的位置>
           卸载服务： instsrv <服务名称> REMOVE

         步骤一：扫吃有NT弱口令的主机

        步骤二：用opentelnet打开远程主机Telnet服务、修改目标主机端口、去除NTLM验证。
         无论远程主机是否开启“Telnet服务”，入侵者都可以通过工具opentelnet来解决。比如，通过下属命令为IP地址为193.168.27.129的目标主机去掉NTLM认证。而且，在开启Telnet服务的同时，又将目标主机中的Telnet服务的默认端口23改为66.其中“”的意思指administrator的密码为空。
       opentelnet \\193.168.27.129 administrator "" 1 66

        步骤三：把所需文件（instsrv.exe、 AproMan)复制到远程主机。
        首先建立IPC$,然后通过映射网络硬盘的方法把所需文件复制、黏贴到远程计算机的c:\winnt文件夹中。具体过程如下：
c:\>net use \\193.168.27.129\IPC$ "" /user:"administrator" 
命令完成成功
c:\>net use z: \\193.168.27.129\c$
命令完成成功
c:\>...................

         步骤四：Telnet登录
         在MS-DOS中键入命令“telnet 193.168.27.129 ”   来登录远程远程主机193.168.27.129。

        步骤五：杀死防火墙进程
         如果黑客需要把类似木马的程序复制到远程主机并行执行，那么他们会事先关闭远程主机中的杀毒软件。虽然这里没有复制类似木马的程序到远程主机，但还是要介绍一下这一过程。当黑客登录成功后，他们会进入到c:\winnt目录中使用AproMan程序。首先通过命令AproMan -A查看所有的进程，然后找到杀毒防火墙进程的PID，最后使用AproMan -t 【PID】来杀掉杀毒防火墙。

       步骤六：另外安装更为隐蔽的Telnet服务

       为了事后仍然能登录到该计算机，黑客在第一次登陆之后都会留下后门。这里来介绍一下黑客如何通过安装系统服务的方法来让Telnet服务永远运行。在安装服务之前，有必要了解一下Windows操作系统是如何提供“Telnet服务”的。打开“计算机管理”，然后查看“Telnet服务”属性。在“Telnet服务”窗口中，可以看到其中“可执行文件的路径”指向“C:\WINDOWS\system32\tlntsvr.exe”。可见，程序tlntsvr.exe就是windows系统中专门用来提供“Telnet服务”的。也就是说，如果某服务指向该程序，那么该服务就会提供Telnet服务。因此，黑客可以自定义一个新服务，该服务指向tlntsvr.exe，从而通过该服务提供的Telnet服务登录，这样做后，即使远程主机上的Telnet服务是被禁用的，黑客也可以毫无阻碍地登录到远程计算机，这种方法被称之为Telnet后门。下面就介绍一下上述过程是如何实现的。首先进入instsrv所在目录，然后使用instsrv.exe建立一个名为“SYSHEALTH”的服务，并把这个服务指向“C:\WINDOWS\system32\tlntsvr.exe”根据intstsrv.exe的用法，键入命令"intstsrv.exe SYSHEALTH C:\WINDOWS\system32\tlntsvr.exe "。一个名为“SYSHEALTH”的服务就这样建立成功了。虽然从表面上看去该服务与远程连接不存在任何关系 ，但是实际上该服务是入侵者留下的Telnet后门服务。
       通过“计算机管理”可以看到该服务已经添加远程在远程计算机上，黑客一般会把这个服务的启动类型设置为“自动”，把原来的“Telnet服务”停止并禁用。
       通过验证可知，虽然远程主机上的Telnet服务已经被停止并禁用，但是黑客仍然能过通过Telnet来控制远程主机。通过这些修改，即使管理员使用“netstat -n”命令来查看开放端口也看不出66端口正在提供Telnet服务。
 

